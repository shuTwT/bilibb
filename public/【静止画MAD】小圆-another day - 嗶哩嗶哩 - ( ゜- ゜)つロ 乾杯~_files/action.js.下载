var _____WB$wombat$assign$function_____ = function(name) {return (self._wb_wombat && self._wb_wombat.local_init && self._wb_wombat.local_init(name)) || self[name]; };
if (!self.__WB_pmw) { self.__WB_pmw = function(obj) { this.__WB_source = obj; return this; } }
{
  let window = _____WB$wombat$assign$function_____("window");
  let self = _____WB$wombat$assign$function_____("self");
  let document = _____WB$wombat$assign$function_____("document");
  let location = _____WB$wombat$assign$function_____("location");
  let top = _____WB$wombat$assign$function_____("top");
  let parent = _____WB$wombat$assign$function_____("parent");
  let frames = _____WB$wombat$assign$function_____("frames");
  let opener = _____WB$wombat$assign$function_____("opener");

var canSub = true;
var canmunq = null;

function submitForm(e) {
	try{
		e = e ? e : window.event;
		if(e.ctrlKey&&e.keyCode==13)
		return true;
	}catch(e){}
	return false
} 	
function commSubmit(form)
{
	
	if ('请在这里输入您要发表的评论信息' == $_element('comment_text').value)
	{
		$_element('comment_text').focus();
		return false;
	}
	if ($_element('comment_text').value.indexOf("@qq.com") >= 0)
	{
		$_element('ajaxBackMsg').innerHTML += "　福利你妹啊！能不能自重点的？要看福利自己下载去！";
		$_element('comment_text').focus();
		return false;
	}
	if ($_element('comment_text').value.length > 1000 || $_element('comment_text').value.length < 4)
	{
		alert("评论字数必须在4到1000个之间！");
		$_element('comment_text').focus();
		return false;
	}

	
	

	postfeeback();
}

function loadfeeback(id,page){

	var URL = Indexurl+"/plus/feedback_tg.php";
	var pars = 'aid=' + id ;
	var ererer=new Ajax.Updater(
		{success: 'comm_content'},
		URL, {
		evalScripts: true,
		method: "get",parameters:pars,
	//	onLoading : tg_loading, //正在获得内容的时候调用的函数天工开物
		onComplete : tg_done    //内容获取完毕的时候调用的函数天工开物

		
		}
	);	
	//for(ad in ererer){
	//	alert(ad+":"+ererer[ad]);}
}

//处理分页部分,将分页部分的连接用正则替换成AJAX所需要的格式,不用更改DEDE后台  BY天工开物

function tg_done()
{
	//alert($_element('tg_pl_page').innerHTML);
	//正则替换分页部分的连接BY天工开物
	$_element('tg_pl_page').innerHTML=$_element('tg_pl_page').innerHTML.replace(/href([^?]+)\?([^"]+)\"/g,"href=\"javascript:AjaxPage_page('$2')\"");
	$_element('comm_content').innerHTML=unescape($_element('comm_content').innerHTML);
}

var rat_id;
function loadrating(id,mpars){
	rat_id = id;
	var URL = Indexurl+"/plus/comment.php";
	var pars = 'aid=' + id+'&'+mpars ;
	var ererer=new Ajax.Updater(
		{success: 'arc_r_box'},
		URL, {
		evalScripts: true,
		method: "get",parameters:pars,
		onComplete : tgrat_done    //内容获取完毕的时候调用的函数天工开物

		
		}
	);	
	//for(ad in ererer){
	//	alert(ad+":"+ererer[ad]);}
}
function loadratingpage(pars){
	var URL = Indexurl+"/plus/comment.php";
	var ererer=new Ajax.Updater(
		{success: 'arc_r_box'},
		URL, {
		evalScripts: true,
		method: "get",
		parameters:pars,
		onComplete : tgrat_done    //内容获取完毕的时候调用的函数天工开物

		
		}
	);	
	//for(ad in ererer){
	//	alert(ad+":"+ererer[ad]);}
}

//处理分页部分,将分页部分的连接用正则替换成AJAX所需要的格式,不用更改DEDE后台  BY天工开物

function tgrat_done()
{
	//alert($_element('tg_pl_page').innerHTML);
	//正则替换分页部分的连接BY天工开物
	$_element('rating_page').innerHTML=$_element('rating_page').innerHTML.replace(/href([^?]+)\?([^"]+)\"/g,"href=\"javascript:loadratingpage('$2')\"");
	$_element('arc_r_box').innerHTML=unescape($_element('arc_r_box').innerHTML);
	$rat = $('.ratin li');
	$rat.click(function(){
		var index = $rat.index($(this));
		if(index == 4)
		{
			$('.w_c_n').hide();
		}
		else
		{
			$('.w_c_n').show();
		}
		$rat.removeClass();
		$($rat.get(index)).addClass('on');
		$('#rating').val($($rat.get(index)).attr('v'));
	});
	$('#ratconfirm').click(
		function()
		{
			var msg="";
			switch (parseInt($('#rating').val()))
			{
				case 5:
				case 10:
				case 20:
					msg=($('#rating').val()*parseInt($('#multiply').val()))+'积分';
					break;
				case 100:
					msg=$('#multiply').val()+'硬币';
			}
			return confirm('此次操作将消耗您'+msg+'。请确认是否继续？');
		}
	);
}


//天工LOAD好评.差评,中立
//xm/plus/feedback.php?aid=1&ftype=good
function loadfeeback_tg(id,page){
	
	var URL = Indexurl+"/plus/feedback_tg.php";
	var pars = 'aid=' + id + '&ftype='+page;
	
	new Ajax.Updater(
		{success: 'comm_content'},
		URL, {
		evalScripts: true,
		method: "get",
		parameters:pars,
	//	onLoading : tg_loading, //正在获得内容的时候调用的函数天工开物
		onComplete : tg_done    //内容获取完毕的时候调用的函数天工开物
		}
	);	
}


function loadfeeback_page(page){
	
	var URL = Indexurl+"/plus/feedback_tg.php";
	var pars = page;
	
	new Ajax.Updater(
		{success: 'comm_content'},
		URL, {
		evalScripts: true,
		method: "get",
		parameters:pars,
	//	onLoading : tg_loading, //正在获得内容的时候调用的函数天工开物
		onComplete : tg_done    //内容获取完毕的时候调用的函数天工开物
		}
	);	
}
function loadvalidate(page){
	
	var URL = Indexurl+"/plus/feedback_tg.php";
	var pars = 'tgyz=1&validate='+page;
	
	www=new Ajax.Request(
		
		URL, {method: "get",
		parameters:pars,
	//	onLoading : tg_loading, //正在获得内容的时候调用的函数天工开物
		onComplete : check_tg ,   //内容获取完毕的时候调用的函数天工开物
		asynchronous:false 
		}
	);	

}

function check_tg(originalRequest)
{
	canmunq = originalRequest.responseText;
}

//ajax submit data....
function postfeeback(){
	if (!canSub)return false;
    var pst_bodt='action='+$_element('action').value+'&aid='+$_element('aid').value+'&isconfirm=yes&msg='+ encodeURIComponent($_element('comment_text').value.replace(/%/g,"%25")).replace(/\+/g,"%2B") + '&comtype='+$_element('comtype').value;
	var post_body;
	
	if($_element('validate_tg'))
	{
		loadvalidate($_element('validate_tg').value);
		
	
	
				if(canmunq==1){
				alert("请输入正确的验证码");
				$_element('validate_tg').focus();
				canSub=true;
				return false;
				}
				
				
		if($_element('notuser').checked)
		{
			if($_element('username_tg'))
			{
			post_body=pst_bodt+'&username='+$_element('username_tg').value+'&notuser=1';
			
			}
			else{post_body=pst_bodt+'&notuser=1';}
		
		}
		else{
			if($_element('username_tg'))
			{
			post_body=pst_bodt+'&username='+$_element('username_tg').value+'&notuser=0';
			
			}
			else{
				if($_element('username_pl').value==""||$_element('pwd').value=="")
				{
				alert("请先登陆后再发表评论！");
				canSub=true;
				return false;
				}
				
				post_body=pst_bodt+'&username='+$_element('username_pl').value+'&pwd='+$_element('pwd').value;
				
				
				}
			
			}
	
		
	}
	//以下是评论不采取验证码
	else 
	{
		
		if($_element('notuser').checked)
		{
			if($_element('username_tg'))
			{
			post_body=pst_bodt+'&username='+$_element('username_tg').value+'&notuser=1';
			
			}
			else{post_body=pst_bodt+'&notuser=1';}
		
		}
		else{
			if($_element('username_tg'))
			{
			post_body=pst_bodt+'&username='+$_element('username_tg').value;
			
			}
			else{
				if($_element('username_pl').value==""||$_element('pwd').value=="")
				{
				alert("请先登陆后再发表评论！");
				canSub=true;
				return false;
				}
				post_body=pst_bodt+'&username='+$_element('username_pl').value+'&pwd='+$_element('pwd').value;
				}
			
			}
		
		
	}
	
	canSub=false;
	
	var opt = {
		method: 'post',
		postBody: post_body,
		onSuccess: function(t) {
			$_element('ajaxBackMsg').update(t.responseText);
			loadfeeback_tg($_element('aid').value,1);
			canSub = true;
			$_element('comment_text').value = '';
			$_element('username').value = '';
			$_element('validate').value = '';
			$_element('code_pic').src = Indexurl+'/include/validateimg.php?'+Math.random();
		},
		on404: function(t) {$_element('ajaxBackMsg').update('服务器错误，请稍后再试！')},
		onFailure: function(t) {$_element('ajaxBackMsg').update('提交失败，请稍后再试！')}
	};
	
	new Ajax.Request(Indexurl+"/plus/feedback_tg.php", opt);
	
}

//输入字符统计
function alertCharNums(content) {
		var MaxLength = 1000 ;
		if (content.value.length > MaxLength ){
			content.value = content.value.substring(0,MaxLength);
		}
		$_element('ajaxBackMsg').innerHTML='字符统计:'+content.value.length+'/1000';
		
	}
	

function AjaxPage_page(p){loadfeeback_page(p)}

/**
 * 回到页面顶部
 * @param acceleration 加速度
 * @param time 时间间隔 (毫秒)
 **/
function goTop(acceleration, time) {
 acceleration = acceleration || 0.1;
 time = time || 16;
 
 var x1 = 0;
 var y1 = 0;
 var x2 = 0;
 var y2 = 0;
 var x3 = 0;
 var y3 = 0;
 
 if (document.documentElement) {
  x1 = document.documentElement.scrollLeft || 0;
  y1 = document.documentElement.scrollTop || 0;
 }
 if (document.body) {
  x2 = document.body.scrollLeft || 0;
  y2 = document.body.scrollTop || 0;
 }
 var x3 = window.scrollX || 0;
 var y3 = window.scrollY || 0;
 
 // 滚动条到页面顶部的水平距离
 var x = Math.max(x1, Math.max(x2, x3));
 // 滚动条到页面顶部的垂直距离
 var y = Math.max(y1, Math.max(y2, y3));
 
 // 滚动距离 = 目前距离 / 速度, 因为距离原来越小, 速度是大于 1 的数, 所以滚动距离会越来越小
 var speed = 1 + acceleration;
 window.scrollTo(Math.floor(x / speed), Math.floor(y / speed));
 
 // 如果距离不为零, 继续调用迭代本函数
 if(x > 0 || y > 0) {
  var invokeFunction = "goTop(" + acceleration + ", " + time + ")";
  window.setTimeout(invokeFunction, time);
 }
}
function loadcomm(aid){
	document.getElementById("cm_ct_btn").innerHTML = '<img src="https://web.archive.org/web/20120203181611/http://static.loli.my/images/morecomm.gif" border="0" style="cursor:pointer"><br/><img src="https://web.archive.org/web/20120203181611/http://static.loli.my/plus/img/loading.gif" alt="loading.." /> 馒头祈祷中....';
	loadfeeback(aid,1);
}


}
/*
     FILE ARCHIVED ON 18:16:11 Feb 03, 2012 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 14:36:15 Jan 01, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
*/
/*
playback timings (ms):
  captures_list: 144.89
  exclusion.robots: 0.076
  exclusion.robots.policy: 0.067
  cdx.remote: 0.066
  esindex: 0.009
  LoadShardBlock: 113.078 (3)
  PetaboxLoader3.datanode: 72.242 (4)
  PetaboxLoader3.resolve: 66.593 (2)
  load_resource: 39.82
*/